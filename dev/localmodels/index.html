



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Predicting timeseries using methods from nonlinear dynamics.">
      
      
      
        <meta name="author" content="Jonas Isensee & George Datseris">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.4">
    
    
      
        <title>Local Modeling & Timeseries Prediction - TimeseriesPrediction</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../assets\Documenter.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#local-modeling" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="TimeseriesPrediction" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                TimeseriesPrediction
              </span>
              <span class="md-header-nav__topic">
                Local Modeling & Timeseries Prediction
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/JuliaDynamics/TimeseriesPrediction.jl/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="TimeseriesPrediction" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    TimeseriesPrediction
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/JuliaDynamics/TimeseriesPrediction.jl/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Local Modeling & Timeseries Prediction
      </label>
    
    <a href="./" title="Local Modeling & Timeseries Prediction" class="md-nav__link md-nav__link--active">
      Local Modeling & Timeseries Prediction
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#local-model-prediction" title="Local Model Prediction" class="md-nav__link">
    Local Model Prediction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-timeseries-example" title="Single Timeseries Example" class="md-nav__link">
    Single Timeseries Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-timeseries-example" title="Multiple Timeseries Example" class="md-nav__link">
    Multiple Timeseries Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-measures" title="Error Measures" class="md-nav__link">
    Error Measures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cool-animation" title="Cool animation!" class="md-nav__link">
    Cool animation!
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../spatiotemporal/" title="Spatio-Temporal Prediction" class="md-nav__link">
      Spatio-Temporal Prediction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../stexamples/" title="Spatio-Temporal Examples" class="md-nav__link">
      Spatio-Temporal Examples
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#local-model-prediction" title="Local Model Prediction" class="md-nav__link">
    Local Model Prediction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-timeseries-example" title="Single Timeseries Example" class="md-nav__link">
    Single Timeseries Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-timeseries-example" title="Multiple Timeseries Example" class="md-nav__link">
    Multiple Timeseries Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-measures" title="Error Measures" class="md-nav__link">
    Error Measures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cool-animation" title="Cool animation!" class="md-nav__link">
    Cool animation!
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/JuliaDynamics/TimeseriesPrediction.jl/edit/master/docs/localmodels.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <p><a id='Local-Modeling-1'></a></p>
<h1 id="local-modeling">Local Modeling</h1>
<div class="admonition tip">
<p class="admonition-title">Reconstruction parameters</p>
<p>Don't forget that <a href="https://juliadynamics.github.io/DynamicalSystems.jl/latest/"><strong>DynamicalSystems.jl</strong></a> also has functions for estimating good parameters for delay embedding: <code>estimate_delay</code> and <code>estimate_dimension</code>.</p>
</div>
<p><a id='Local-Model-Prediction-1'></a></p>
<h2 id="local-model-prediction">Local Model Prediction</h2>
<p><a id='TimeseriesPrediction.localmodel_tsp' href='#TimeseriesPrediction.localmodel_tsp'>#</a>
<strong><code>TimeseriesPrediction.localmodel_tsp</code></strong> &mdash; <em>Function</em>.</p>
<div class="codehilite"><pre><span></span><span class="nt">localmodel_tsp</span><span class="o">(</span><span class="nt">s</span><span class="o">,</span> <span class="err">γ</span><span class="p">::</span><span class="nd">Int</span><span class="o">,</span> <span class="err">τ</span><span class="o">,</span> <span class="nt">p</span><span class="p">::</span><span class="nd">Int</span><span class="o">;</span> <span class="nt">method</span><span class="o">,</span> <span class="nt">ntype</span><span class="o">,</span> <span class="nt">stepsize</span><span class="o">)</span>
<span class="nt">localmodel_tsp</span><span class="o">(</span><span class="nt">s</span><span class="o">,</span> <span class="nt">p</span><span class="p">::</span><span class="nd">Int</span><span class="o">;</span> <span class="nt">method</span><span class="o">,</span> <span class="nt">ntype</span><span class="o">,</span> <span class="nt">stepsize</span><span class="o">)</span>
</pre></div>


<p>Perform a timeseries prediction for <code>p</code> points, using local weighted modeling [1]. The function always returns an object of the same type as <code>s</code>, which can be either a timeseries (vector) or an <code>AbstractDataset</code> (trajectory), and the returned data always contains the final point of <code>s</code> as starting point. This means that the returned data has length of <code>p + 1</code>.</p>
<p>If given <code>(s, γ, τ)</code>, it first calls <code>reconstruct</code> (from <code>DelayEmbeddings</code>) on <code>s</code> with <code>(γ, τ)</code>. If given only <code>s</code> then no reconstruction is done.</p>
<p><strong>Keyword Arguments</strong></p>
<ul>
<li><code>method = AverageLocalModel(ω_unsafe)</code> : Subtype of <a href="./#TimeseriesPrediction.AbstractLocalModel"><code>AbstractLocalModel</code></a>.</li>
<li><code>ntype = FixedMassNeighborhood(2)</code> : Subtype of <code>AbstractNeighborhood</code> (from <code>DelayEmbeddings</code>).</li>
<li><code>stepsize = 1</code> : Prediction step size.</li>
</ul>
<p><strong>Description</strong></p>
<p>Given a query point, the function finds its neighbors using neighborhood <code>ntype</code>. Then, the neighbors <code>xnn</code> and their images <code>ynn</code> are used to make a prediction for the future of the query point, using the provided <code>method</code>. The images <code>ynn</code> are the points <code>xnn</code> shifted by <code>stepsize</code> into the future.</p>
<p>The algorithm is applied iteratively until a prediction of length <code>p</code> has been created, starting with the query point to be the last point of the timeseries.</p>
<p><strong>References</strong></p>
<p>[1] : D. Engster &amp; U. Parlitz, <em>Handbook of Time Series Analysis</em> Ch. 1, VCH-Wiley (2006)</p>
<p><a target='_blank' href='https://github.com/JuliaDynamics/TimeseriesPrediction.jl/blob/ccdf008f1c4e2f52fa081ac4705ff9eb6aa585b5/src/localmodeling.jl#L289-L321' class='documenter-source'>source</a><br></p>
<p><a id='TimeseriesPrediction.AbstractLocalModel' href='#TimeseriesPrediction.AbstractLocalModel'>#</a>
<strong><code>TimeseriesPrediction.AbstractLocalModel</code></strong> &mdash; <em>Type</em>.</p>
<div class="codehilite"><pre><span></span>AbstractLocalModel
</pre></div>


<p>Supertype of methods for making a prediction of a query point <code>q</code> using local models, following the methods of [1]. Concrete subtypes are <code>AverageLocalModel</code> and <code>LinearLocalModel</code>.</p>
<p>All models weight neighbors with a chosen function, so that distant neighbors have smaller impact on the prediction and so that the interpolation is smooth. The default weighting function we use is</p>
<div>
<div class="MathJax_Preview">
\begin{aligned}
ω_i(d_i,d_{max}) = \left[ 1- \left(\frac{d_i}{d_{max}}\right)^2\right]^4
\end{aligned}
</div>
<script type="math/tex; mode=display">
\begin{aligned}
ω_i(d_i,d_{max}) = \left[ 1- \left(\frac{d_i}{d_{max}}\right)^2\right]^4
\end{aligned}
</script>
</div>
<p>with <span><span class="MathJax_Preview">d_i = ||x_{nn,i} -q||_2</span><script type="math/tex">d_i = ||x_{nn,i} -q||_2</script></span> being the distance of each neighbor from the query point.</p>
<p>You can also provide your own function or give <code>ω_safe(d, dmax) = dmax &gt; 0 ? (1.1 - (d/dmax)^2)^4 : 1.0</code> for a safe version of <span><span class="MathJax_Preview">ω</span><script type="math/tex">ω</script></span> that takes into acount edge cases. Finally you can also give <code>nothing</code> in place of <code>ω</code>. In that case no weighting is done and direct average of neighbors is returned.</p>
<p><strong>Average Local Model</strong></p>
<div class="codehilite"><pre><span></span>AverageLocalModel(ω)
</pre></div>


<p>The prediction is simply the weighted average of the images <span><span class="MathJax_Preview">y_{nn, i}</span><script type="math/tex">y_{nn, i}</script></span> of the neighbors <span><span class="MathJax_Preview">x_{nn, i}</span><script type="math/tex">x_{nn, i}</script></span> of the query point <code>q</code>, weighting using given function <code>ω</code></p>
<div>
<div class="MathJax_Preview">
\begin{aligned}
y_{pred} = \frac{\sum{\omega_i y_{nn,i}}}{\sum{\omega_i}}
\end{aligned}
</div>
<script type="math/tex; mode=display">
\begin{aligned}
y_{pred} = \frac{\sum{\omega_i y_{nn,i}}}{\sum{\omega_i}}
\end{aligned}
</script>
</div>
<p><strong>Linear Local Model</strong></p>
<div class="codehilite"><pre><span></span>LinearLocalModel([ω ], μ::Real=2.])
LinearLocalModel([ω ], s_min::Real, s_max::Real)
</pre></div>


<p>The prediction is a weighted linear regression over the neighbors <span><span class="MathJax_Preview">x_{nn, i}</span><script type="math/tex">x_{nn, i}</script></span> of the query and their images <span><span class="MathJax_Preview">y_{nn,i}</span><script type="math/tex">y_{nn,i}</script></span> as shown in [1].</p>
<p>Giving either <code>μ</code> or <code>s_min</code> and <code>s_max</code> determines which type of regularization is applied.</p>
<ul>
<li>
<p><code>μ</code> : Ridge Regression</p>
<p>
<script type="math/tex; mode=display">
\begin{aligned}
f(\sigma) = \frac{\sigma^2}{\mu^2 + \sigma^2}
\end{aligned}
</script>
  * <code>s_min</code>, <code>s_max</code> : Soft Threshold</p>
<div>
<div class="MathJax_Preview">
\begin{aligned}
f(\sigma) = \begin{cases} 0, &amp; \sigma &lt; s_{min}\\
\left(1 - \left( \frac{s_{max}-\sigma}{s_{max}-s_{min}}\right)^2 \right)^2,
&amp;s_{min} \leq \sigma \leq s_{max} \\
1, &amp; \sigma &gt; s_{max}\end{cases}
\end{aligned}
</div>
<script type="math/tex; mode=display">
\begin{aligned}
f(\sigma) = \begin{cases} 0, & \sigma < s_{min}\\
\left(1 - \left( \frac{s_{max}-\sigma}{s_{max}-s_{min}}\right)^2 \right)^2,
&s_{min} \leq \sigma \leq s_{max} \\
1, & \sigma > s_{max}\end{cases}
\end{aligned}
</script>
</div>
</li>
</ul>
<p><strong>References</strong></p>
<p>[1] : D. Engster &amp; U. Parlitz, <em>Handbook of Time Series Analysis</em> Ch. 1, VCH-Wiley (2006)</p>
<p><a target='_blank' href='https://github.com/JuliaDynamics/TimeseriesPrediction.jl/blob/ccdf008f1c4e2f52fa081ac4705ff9eb6aa585b5/src/localmodeling.jl#L10-L75' class='documenter-source'>source</a><br></p>
<p><a id='Single-Timeseries-Example-1'></a></p>
<h2 id="single-timeseries-example">Single Timeseries Example</h2>
<p>We will predict the future of a (relatively simple) timeseries:</p>
<div class="codehilite"><pre><span></span><span class="k">using</span> <span class="n">TimeseriesPrediction</span> <span class="c"># re-exports DelayEmbeddings</span>
<span class="k">using</span> <span class="n">DynamicalSystemsBase</span> <span class="c"># to access some systems</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">Systems</span><span class="o">.</span><span class="n">roessler</span><span class="p">(</span><span class="mf">0.1</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
<span class="n">N_train</span> <span class="o">=</span> <span class="mi">6001</span>
<span class="n">s_train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">N_train</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">s_test</span>  <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">N_train</span><span class="o">:</span><span class="k">end</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="n">ntype</span> <span class="o">=</span> <span class="n">FixedMassNeighborhood</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">s_pred</span> <span class="o">=</span> <span class="n">localmodel_tsp</span><span class="p">(</span><span class="n">s_train</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span> <span class="n">ntype</span><span class="o">=</span><span class="n">ntype</span><span class="p">)</span>

<span class="k">using</span> <span class="n">PyPlot</span>
<span class="n">figure</span><span class="p">()</span>
<span class="n">plot</span><span class="p">(</span><span class="mi">550</span><span class="o">:</span><span class="n">dt</span><span class="o">:</span><span class="mi">600</span><span class="p">,</span> <span class="n">s_train</span><span class="p">[</span><span class="mi">5501</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;training (trunc.)&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;C1&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="mi">600</span><span class="o">:</span><span class="n">dt</span><span class="o">:</span><span class="p">(</span><span class="mi">600</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">dt</span><span class="p">),</span> <span class="n">s_test</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;C3&quot;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;actual signal&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="mi">600</span><span class="o">:</span><span class="n">dt</span><span class="o">:</span><span class="p">(</span><span class="mi">600</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">dt</span><span class="p">),</span> <span class="n">s_pred</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;C0&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;predicted&quot;</span><span class="p">)</span>

<span class="n">title</span><span class="p">(</span><span class="s">&quot;Pool of points: </span><span class="si">$</span><span class="p">(</span><span class="n">N_train</span><span class="p">)</span><span class="s">, predicted points: </span><span class="si">$</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">t</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">x</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">tight_layout</span><span class="p">()</span>
</pre></div>


<p><img alt="" src="../single_tspred.png" /></p>
<p><a id='Multiple-Timeseries-Example-1'></a></p>
<h2 id="multiple-timeseries-example">Multiple Timeseries Example</h2>
<p>Predicting multivariate timeseries works the same as with scalar timeseries.</p>
<div class="codehilite"><pre><span></span><span class="k">using</span> <span class="n">TimeseriesPrediction</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">Systems</span><span class="o">.</span><span class="n">roessler</span><span class="p">(</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
<span class="n">N_train</span> <span class="o">=</span> <span class="mi">1501</span>
<span class="n">s_train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">N_train</span><span class="p">,</span> <span class="n">SVector</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
<span class="c">#Identical to data[1:N_train, 1:2] but much faster</span>
<span class="n">s_test</span>  <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">N_train</span><span class="o">:</span><span class="k">end</span><span class="p">,</span> <span class="n">SVector</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>

<span class="n">p</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="n">stepsize</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">s_pred_10</span> <span class="o">=</span> <span class="n">localmodel_tsp</span><span class="p">(</span><span class="n">s_train</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span>  <span class="n">stepsize</span> <span class="o">=</span> <span class="n">stepsize</span><span class="p">)</span>

<span class="k">using</span> <span class="n">PyPlot</span><span class="p">;</span> <span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">idx_prev</span> <span class="o">=</span> <span class="mi">200</span> <span class="c"># how many previous points to show</span>
<span class="n">tf</span> <span class="o">=</span> <span class="kt">Int</span><span class="p">((</span><span class="n">N_train</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span> <span class="c"># final time of test set</span>

<span class="c"># Plot real x-coordinate</span>
<span class="n">plot</span><span class="p">((</span><span class="n">tf</span> <span class="o">-</span> <span class="n">idx_prev</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">:</span><span class="n">dt</span><span class="o">:</span><span class="n">tf</span><span class="p">,</span> <span class="n">s_train</span><span class="p">[</span><span class="n">N_train</span><span class="o">-</span><span class="n">idx_prev</span><span class="o">:</span><span class="k">end</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;real x&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;C1&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">tf</span><span class="o">:</span><span class="n">dt</span><span class="o">:</span><span class="p">(</span><span class="n">tf</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">stepsize</span><span class="p">),</span> <span class="n">s_test</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">p</span><span class="o">*</span><span class="n">stepsize</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;C1&quot;</span><span class="p">)</span>
<span class="c"># Plot predicted x-coordinate</span>
<span class="n">plot</span><span class="p">(</span><span class="n">tf</span><span class="o">:</span><span class="n">dt</span><span class="o">*</span><span class="n">stepsize</span><span class="o">:</span><span class="p">(</span><span class="n">tf</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">stepsize</span><span class="p">),</span> <span class="n">s_pred_10</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;C3&quot;</span><span class="p">,</span>
<span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;pred. x&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">)</span>

<span class="c"># Plot real y-coordinate</span>
<span class="n">plot</span><span class="p">((</span><span class="n">tf</span> <span class="o">-</span> <span class="n">idx_prev</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">:</span><span class="n">dt</span><span class="o">:</span><span class="n">tf</span><span class="p">,</span> <span class="n">s_train</span><span class="p">[</span><span class="n">N_train</span><span class="o">-</span><span class="n">idx_prev</span><span class="o">:</span><span class="k">end</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;real y&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;C0&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">tf</span><span class="o">:</span><span class="n">dt</span><span class="o">:</span><span class="p">(</span><span class="n">tf</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">stepsize</span><span class="p">),</span> <span class="n">s_test</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">p</span><span class="o">*</span><span class="n">stepsize</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;C0&quot;</span><span class="p">)</span>
<span class="c"># Plot predicted y-coordinate</span>
<span class="n">plot</span><span class="p">(</span><span class="n">tf</span><span class="o">:</span><span class="n">dt</span><span class="o">*</span><span class="n">stepsize</span><span class="o">:</span><span class="p">(</span><span class="n">tf</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">stepsize</span><span class="p">),</span> <span class="n">s_pred_10</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;C9&quot;</span><span class="p">,</span>
<span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;pred. y&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">)</span>

<span class="c"># Plot start of prediction</span>
<span class="n">plot</span><span class="p">([</span><span class="n">tf</span><span class="p">,</span><span class="n">tf</span><span class="p">],[</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span> <span class="s">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="n">title</span><span class="p">(</span><span class="s">&quot;Pool of points: </span><span class="si">$</span><span class="p">(</span><span class="n">N_train</span><span class="p">)</span><span class="s">, predicted points: </span><span class="si">$</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">t</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\$</span><span class="s">x, y</span><span class="se">\$</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">tight_layout</span><span class="p">()</span>
</pre></div>


<p><img alt="" src="../multiple_tspred.png" /></p>
<p><a id='Error-Measures-1'></a></p>
<h2 id="error-measures">Error Measures</h2>
<p>Being able to evaluate model performance without looking at plots can be very helpful when trying to quantify its error as well as finding good parameters in the first place.</p>
<p><a id='TimeseriesPrediction.MSEp' href='#TimeseriesPrediction.MSEp'>#</a>
<strong><code>TimeseriesPrediction.MSEp</code></strong> &mdash; <em>Function</em>.</p>
<div class="codehilite"><pre><span></span><span class="nt">MSEp</span><span class="o">(</span><span class="nt">R</span><span class="p">::</span><span class="nd">AbstractDataset</span><span class="p">{</span><span class="err">D,T</span><span class="p">}</span><span class="o">,</span> <span class="nt">R_test</span><span class="o">,</span> <span class="nt">p</span><span class="o">;</span> <span class="nt">method</span><span class="o">,</span> <span class="nt">ntype</span><span class="o">,</span> <span class="nt">stepsize</span><span class="o">)</span> <span class="nt">-</span><span class="o">&gt;</span> <span class="nt">error</span>
</pre></div>


<p>Compute mean squared error of iterated predictions of length <code>p</code> using test set <code>R_test</code>.</p>
<p><strong>Description</strong></p>
<p>This error measure takes in a prediction model consisting of <code>R</code>, <code>method</code>, <code>ntype</code> and <code>stepsize</code> and evaluates its performance. The test set <code>R_test</code> is a delay reconstruction with the same delay <code>τ</code> and dimension <code>D</code> as <code>R</code>. For each subset of <code>R_test</code> with length <code>p</code> it calls <code>localmodel_tsp</code>. The model error is then defined as</p>
<div>
<div class="MathJax_Preview">
\begin{aligned}
MSE_p = \frac{1}{p|T_{ref}|}\sum_{t\in T_{ref}}\sum_{i=1}^{p} \left(y_{t+i}
- y_{pred,t+i} \right)^2
\end{aligned}
</div>
<script type="math/tex; mode=display">
\begin{aligned}
MSE_p = \frac{1}{p|T_{ref}|}\sum_{t\in T_{ref}}\sum_{i=1}^{p} \left(y_{t+i}
- y_{pred,t+i} \right)^2
\end{aligned}
</script>
</div>
<p>where <span><span class="MathJax_Preview">|T_{ref}|</span><script type="math/tex">|T_{ref}|</script></span> is the number of subsets of <code>R_test</code> used.</p>
<p><strong>References</strong></p>
<p>See <a href="./#TimeseriesPrediction.localmodel_tsp"><code>localmodel_tsp</code></a>.</p>
<p><a target='_blank' href='https://github.com/JuliaDynamics/TimeseriesPrediction.jl/blob/ccdf008f1c4e2f52fa081ac4705ff9eb6aa585b5/src/localmodeling.jl#L457-L479' class='documenter-source'>source</a><br></p>
<p>Here is an example function that employs <code>MSEp</code> to find good parameters. It takes in a timeseries <code>s</code> and ranges for the dimensions, delays and number of nearest neighbors to  try. Keyword arguments are <code>valid_len</code>, which is the number of prediction steps, and <code>num_tries</code> the number of different starting points to choose.</p>
<p>It then calculates <code>MSEp</code> for all parameter combinations and returns the best parameter set.</p>
<p>```@example tspred
function estimate_param(s::AbstractVector,
    dims, delay, K; valid_len=100, num_tries=50)
    result = Dict{NamedTuple,Float64}()
    step = 1
    for γ ∈ dims, τ ∈ delay
        s_train = @view s[1:end-(γ+1)<em>τ-valid_len-num_tries-50]
        s_test = @view s[end-γ</em>τ-valid_len-num_tries:end]
        R = reconstruct(s_train,γ,τ)
        R_test = reconstruct(s_test,γ,τ)
        tree = KDTree(R[1:end-1])
        for k ∈ K
            ntype = FixedMassNeighborhood(k)
            result[(D=D,τ=τ,k=k)] =
            MSEp(R, tree, R_test, valid_len; ntype=ntype)
        end
    end
    best_param = collect(keys(result))[findmin(collect(values(result)))[2]]
    return best_param
end</p>
<p>ds = Systems.roessler(0.1ones(3))
dt = 0.1
data = trajectory(ds, 1000; dt=dt)
N_train = 6001
s_train = data[1:N_train, 1]
s_test  = data[N_train:end,1]</p>
<p>D, τ, k = estimate_param(s_train, 1:4, [10, 15, 30], 2:4)
```</p>
<p><a id='Cool-animation!-1'></a></p>
<h2 id="cool-animation">Cool animation!</h2>
<p>This is an animation of timeseries prediction of the <code>z</code> variable of the Roessler system. On the left you can see the time evolution of the whole system with the chaotic attractor indicated in gray. The right side is a plot of the <code>z</code> component of the system. The actual values are displayed in green. In red you can see the iteratively predicted version. As training set it used part of the attractor shown in gray on the left.</p>
<video controls="controls"> <source src="https://github.com/JuliaDynamics/JuliaDynamicsDocumentation.jl/blob/master/animations/tspred/tspred*animation*zRossler.mp4?raw=true" type="video/mp4"> </video>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </span>
            </div>
          </a>
        
        
          <a href="../spatiotemporal/" title="Spatio-Temporal Prediction" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Spatio-Temporal Prediction
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/JuliaDynamics/TimeseriesPrediction.jl" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.30f6b8b1.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:".."}})</script>
      
        <script src="../assets\mathjaxhelper.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>