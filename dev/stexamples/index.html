



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Predicting timeseries using methods from nonlinear dynamics.">
      
      
      
        <meta name="author" content="Jonas Isensee & George Datseris">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.4">
    
    
      
        <title>Spatio-Temporal Examples - TimeseriesPrediction</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../assets\Documenter.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#spatio-temporal-prediction-examples" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="TimeseriesPrediction" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                TimeseriesPrediction
              </span>
              <span class="md-header-nav__topic">
                Spatio-Temporal Examples
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/JuliaDynamics/TimeseriesPrediction.jl/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="TimeseriesPrediction" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    TimeseriesPrediction
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/JuliaDynamics/TimeseriesPrediction.jl/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../localmodels/" title="Local Modeling & Timeseries Prediction" class="md-nav__link">
      Local Modeling & Timeseries Prediction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../spatiotemporal/" title="Spatio-Temporal Prediction" class="md-nav__link">
      Spatio-Temporal Prediction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Spatio-Temporal Examples
      </label>
    
    <a href="./" title="Spatio-Temporal Examples" class="md-nav__link md-nav__link--active">
      Spatio-Temporal Examples
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#temporal-prediction-kuramoto-sivashinsky" title="Temporal Prediction: Kuramoto-Sivashinsky" class="md-nav__link">
    Temporal Prediction: Kuramoto-Sivashinsky
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#produce-field-u-kuramoto-sivashinsky" title="Produce field U (Kuramoto Sivashinsky)" class="md-nav__link">
    Produce field U (Kuramoto Sivashinsky)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temporal-prediction-of-field-u" title="Temporal prediction of field U" class="md-nav__link">
    Temporal prediction of field U
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-the-result" title="Plot the result" class="md-nav__link">
    Plot the result
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-prediction-barkley-model" title="Cross Prediction: Barkley Model" class="md-nav__link">
    Cross Prediction: Barkley Model
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulate-a-test-system" title="Simulate a test system" class="md-nav__link">
    Simulate a test system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-predict-field-u-from-field-v" title="Cross predict field U from field V" class="md-nav__link">
    Cross predict field U from field V
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-prediction" title="Plot prediction" class="md-nav__link">
    Plot prediction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temporal-prediction-periodic-nonlinear-barkley-model" title="Temporal Prediction: Periodic Nonlinear Barkley Model" class="md-nav__link">
    Temporal Prediction: Periodic Nonlinear Barkley Model
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulate-a-test-system_1" title="Simulate a test system" class="md-nav__link">
    Simulate a test system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temporal-prediction-of-field-u_1" title="Temporal prediction of field U" class="md-nav__link">
    Temporal prediction of field U
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-prediction_1" title="Plot prediction" class="md-nav__link">
    Plot prediction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#temporal-prediction-kuramoto-sivashinsky" title="Temporal Prediction: Kuramoto-Sivashinsky" class="md-nav__link">
    Temporal Prediction: Kuramoto-Sivashinsky
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#produce-field-u-kuramoto-sivashinsky" title="Produce field U (Kuramoto Sivashinsky)" class="md-nav__link">
    Produce field U (Kuramoto Sivashinsky)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temporal-prediction-of-field-u" title="Temporal prediction of field U" class="md-nav__link">
    Temporal prediction of field U
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-the-result" title="Plot the result" class="md-nav__link">
    Plot the result
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-prediction-barkley-model" title="Cross Prediction: Barkley Model" class="md-nav__link">
    Cross Prediction: Barkley Model
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulate-a-test-system" title="Simulate a test system" class="md-nav__link">
    Simulate a test system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-predict-field-u-from-field-v" title="Cross predict field U from field V" class="md-nav__link">
    Cross predict field U from field V
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-prediction" title="Plot prediction" class="md-nav__link">
    Plot prediction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temporal-prediction-periodic-nonlinear-barkley-model" title="Temporal Prediction: Periodic Nonlinear Barkley Model" class="md-nav__link">
    Temporal Prediction: Periodic Nonlinear Barkley Model
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulate-a-test-system_1" title="Simulate a test system" class="md-nav__link">
    Simulate a test system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temporal-prediction-of-field-u_1" title="Temporal prediction of field U" class="md-nav__link">
    Temporal prediction of field U
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot-prediction_1" title="Plot prediction" class="md-nav__link">
    Plot prediction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/JuliaDynamics/TimeseriesPrediction.jl/edit/master/docs/stexamples.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <p><a id='Spatio-Temporal-Prediction-Examples-1'></a></p>
<h1 id="spatio-temporal-prediction-examples">Spatio-Temporal Prediction Examples</h1>
<p>In this page we are simply running files from the <code>examples</code> folder of the <code>TimeseriesPrediction</code> package.</p>
<p>This is how you can (programmatically) find this folder:</p>
<div class="codehilite"><pre><span></span><span class="k">using</span> <span class="n">TimeseriesPrediction</span>
<span class="n">exdir</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">pathof</span><span class="p">(</span><span class="n">TimeseriesPrediction</span><span class="p">)))</span><span class="o">*</span><span class="s">&quot;/examples&quot;</span>
</pre></div>


<p><a id='Temporal-Prediction:-Kuramoto-Sivashinsky-1'></a></p>
<h2 id="temporal-prediction-kuramoto-sivashinsky">Temporal Prediction: Kuramoto-Sivashinsky</h2>
<p><em>(this requires <code>FFTW</code> to be installed)</em></p>
<p>This example predicts the temporal evolution of a one-dimensional field U, along with a time vector T, which has to be represented as vectors of vectors. Where the field comes from does not matter, but to make the example runnable we load one of the test systems of <code>TimeseriesPrediction</code>.</p>
<p>In this example we use the solution of Kuramoto Sivashinsky equation.</p>
<p>Importantly, the results are compared with the "real" evolution of the system.</p>
<p>In the plots, the x axis is space and y axis is time.</p>
<p><a id='Produce-field-U-(Kuramoto-Sivashinsky)-1'></a></p>
<h3 id="produce-field-u-kuramoto-sivashinsky">Produce field U (Kuramoto Sivashinsky)</h3>
<div class="codehilite"><pre><span></span><span class="k">using</span> <span class="n">PyPlot</span>
<span class="k">using</span> <span class="n">TimeseriesPrediction</span>

<span class="n">testdir</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">pathof</span><span class="p">(</span><span class="n">TimeseriesPrediction</span><span class="p">)))</span><span class="o">*</span><span class="s">&quot;/test&quot;</span>
<span class="nd">@assert</span> <span class="n">isdir</span><span class="p">(</span><span class="n">testdir</span><span class="p">)</span>
<span class="n">include</span><span class="p">(</span><span class="n">testdir</span><span class="o">*</span><span class="s">&quot;/ks_solver.jl&quot;</span><span class="p">)</span>

<span class="n">Ntrain</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">Ntrain</span> <span class="o">+</span> <span class="n">p</span>

<span class="n">U</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">KuramotoSivashinsky</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="n">N÷4</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">summary</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>&quot;10101-element Array{Array{Float64,1},1}&quot;
</pre></div>


<p><a id='Temporal-prediction-of-field-U-1'></a></p>
<h3 id="temporal-prediction-of-field-u">Temporal prediction of field U</h3>
<div class="codehilite"><pre><span></span><span class="n">Q</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c"># spatial length</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">Ntrain</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">Ntrain</span><span class="o">:</span><span class="n">N</span><span class="p">]</span>

<span class="n">D</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">τ</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ntype</span> <span class="o">=</span> <span class="n">FixedMassNeighborhood</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">method</span> <span class="o">=</span> <span class="n">AverageLocalModel</span><span class="p">()</span>

<span class="n">em</span> <span class="o">=</span> <span class="n">cubic_shell_embedding</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span><span class="n">τ</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">PeriodicBoundary</span><span class="p">())</span>
<span class="n">pcaem</span><span class="o">=</span> <span class="n">PCAEmbedding</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span><span class="n">em</span><span class="p">)</span>

<span class="nd">@time</span> <span class="n">pred</span> <span class="o">=</span> <span class="n">temporalprediction</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span><span class="n">pcaem</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span><span class="n">ntype</span><span class="o">=</span><span class="n">ntype</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">progress</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>

<span class="n">err</span> <span class="o">=</span> <span class="p">[</span><span class="n">abs</span><span class="o">.</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;Maximum error: &quot;</span><span class="p">,</span> <span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="nb">e</span><span class="p">)</span> <span class="k">for</span> <span class="nb">e</span> <span class="kp">in</span> <span class="n">err</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span>  3.045345 seconds (2.73 M allocations: 256.572 MiB, 8.61% gc time)
Maximum error: 7.489722699875898
</pre></div>


<p><a id='Plot-the-result-1'></a></p>
<h3 id="plot-the-result">Plot the result</h3>
<p>Deduce field extremal values</p>
<div class="codehilite"><pre><span></span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">test</span><span class="p">),</span>
           <span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">pred</span><span class="p">))</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">test</span><span class="p">),</span>
           <span class="n">minimum</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">pred</span><span class="p">))</span>
</pre></div>


<p>Transform data for imshow</p>
<div class="codehilite"><pre><span></span><span class="n">ptest</span> <span class="o">=</span> <span class="n">cat</span><span class="p">(</span><span class="n">test</span><span class="o">...</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ppred</span> <span class="o">=</span> <span class="n">cat</span><span class="p">(</span><span class="n">pred</span><span class="o">...</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">perr</span> <span class="o">=</span> <span class="n">cat</span><span class="p">(</span><span class="n">err</span><span class="o">...</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>64×101 Array{Float64,2}:
 0.0  0.117557     0.093332    0.0995133   …  0.176435  0.428045  1.12381
 0.0  0.0844138    0.0624008   0.0627831      1.03725   0.634373  0.149066
 0.0  0.0487361    0.0268789   0.0249753      1.51933   1.35378   1.12772
 0.0  0.0430553    0.00531474  0.00402415     1.65941   1.72697   1.76369
 0.0  0.0550993    0.00717697  0.00488774     1.54245   1.80927   2.07716
 0.0  0.0513383    0.0131881   0.00198239  …  1.27599   1.69305   2.13234
 0.0  0.0394528    0.0126422   0.0254385      0.977606  1.4845    2.02576
 0.0  0.0222963    0.0454558   0.0583722      0.749201  1.27235   1.84884
 0.0  0.0113543    0.0875975   0.102984       0.625136  1.10491   1.6342
 0.0  0.000283291  0.121417    0.137955       0.64153   1.04758   1.47385
 ⋮                                         ⋱                      ⋮
 0.0  0.0806688    0.0717503   0.0555449   …  3.34076   2.8054    2.20618
 0.0  0.103009     0.0765522   0.0773288      4.80043   4.36622   3.83916
 0.0  0.0407499    0.0130141   0.0274053      5.84244   5.59799   5.24194
 0.0  0.00136207   0.0219034   0.084694       6.28648   6.2951    6.18903
 0.0  0.0325506    0.0315577   0.0891074      6.06503   6.34578   6.52844
 0.0  0.0460529    0.0990307   0.0424581   …  5.23427   5.75757   6.21841
 0.0  0.0623423    0.114259    0.138285       3.96122   4.65298   5.33638
 0.0  0.0751481    0.135083    0.139311       2.47919   3.24312   4.04871
 0.0  0.100207     0.134398    0.130669       1.03333   1.76527   2.57602
</pre></div>


<p>plot plot plot</p>
<div class="codehilite"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>

<span class="n">im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">ppred</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span>
<span class="n">aspect</span> <span class="o">=</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">Ntrain</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="p">))</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">ptest</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span>
<span class="n">aspect</span> <span class="o">=</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">Ntrain</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="p">))</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">ax3</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">perr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;inferno&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">,</span>
<span class="n">aspect</span> <span class="o">=</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">Ntrain</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="p">))</span>

<span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="nb">im</span><span class="p">,</span> <span class="n">ax</span><span class="p">))</span> <span class="kp">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">zip</span><span class="p">([</span><span class="n">im1</span><span class="p">,</span><span class="n">im2</span><span class="p">,</span><span class="n">im3</span><span class="p">],</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">]))</span>
    <span class="n">colorbar</span><span class="p">(</span><span class="nb">im</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="c"># format=&quot;%.1f&quot;)</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">3</span>
        <span class="n">ax</span><span class="p">[</span><span class="o">:</span><span class="n">set_xticklabels</span><span class="p">]([])</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">ax1</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;Prediction&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;Real evolution&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;Absolute error&quot;</span><span class="p">)</span>

<span class="n">ax2</span><span class="p">[</span><span class="o">:</span><span class="n">set_ylabel</span><span class="p">](</span><span class="s">&quot;space&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="p">[</span><span class="o">:</span><span class="n">set_xlabel</span><span class="p">](</span><span class="s">&quot;time&quot;</span><span class="p">)</span>
<span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">)</span>
</pre></div>


<p><img alt="ksprediction" src="../ksprediction.png" /></p>
<p><a id='Cross-Prediction:-Barkley-Model-1'></a></p>
<h2 id="cross-prediction-barkley-model">Cross Prediction: Barkley Model</h2>
<p>This example cross-predicts a field U from a field V. Both fields have to be represented as vectors of matrices. Where the fields come from does not matter, but to make the example runnable we load one of the test systems of TimeseriesPrediction.</p>
<p>This example uses cubic shell embedding and a linear Barkley model.</p>
<p>Importantly, the results are compared with the "real" evolution of the system.</p>
<p><a id='Simulate-a-test-system-1'></a></p>
<h3 id="simulate-a-test-system">Simulate a test system</h3>
<div class="codehilite"><pre><span></span><span class="k">using</span> <span class="n">PyPlot</span>
<span class="k">using</span> <span class="n">TimeseriesPrediction</span>

<span class="n">testdir</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">pathof</span><span class="p">(</span><span class="n">TimeseriesPrediction</span><span class="p">)))</span><span class="o">*</span><span class="s">&quot;/test&quot;</span>
<span class="nd">@assert</span> <span class="n">isdir</span><span class="p">(</span><span class="n">testdir</span><span class="p">)</span>
<span class="n">include</span><span class="p">(</span><span class="n">testdir</span><span class="o">*</span><span class="s">&quot;/system_defs.jl&quot;</span><span class="p">)</span>

<span class="n">Ttrain</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">Ttest</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">Ttrain</span> <span class="o">+</span> <span class="n">Ttest</span>

<span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">barkley</span><span class="p">(</span><span class="n">T</span><span class="p">;</span><span class="n">tskip</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ssize</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
<span class="n">summary</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>&quot;510-element Array{Array{Float64,2},1}&quot;
</pre></div>


<p><a id='Cross-predict-field-U-from-field-V-1'></a></p>
<h3 id="cross-predict-field-u-from-field-v">Cross predict field U from field V</h3>
<div class="codehilite"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">τ</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">bc</span> <span class="o">=</span> <span class="n">PeriodicBoundary</span><span class="p">()</span>

<span class="n">source_train</span> <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span> <span class="n">Ttrain</span><span class="p">]</span>
<span class="n">target_train</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span> <span class="n">Ttrain</span><span class="p">]</span>
<span class="n">source_pred</span>  <span class="o">=</span> <span class="n">V</span><span class="p">[</span><span class="n">Ttrain</span>  <span class="o">-</span> <span class="n">D</span><span class="o">*</span><span class="n">τ</span> <span class="o">+</span> <span class="mi">1</span><span class="o">:</span>  <span class="n">T</span><span class="p">]</span>
<span class="n">target_test</span>  <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">Ttrain</span>        <span class="o">+</span> <span class="mi">1</span><span class="o">:</span>  <span class="n">T</span><span class="p">]</span>

<span class="n">em</span> <span class="o">=</span> <span class="n">cubic_shell_embedding</span><span class="p">(</span><span class="n">source_train</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span><span class="n">τ</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">bc</span><span class="p">)</span>
<span class="n">pcaem</span> <span class="o">=</span> <span class="n">PCAEmbedding</span><span class="p">(</span><span class="n">source_train</span><span class="p">,</span> <span class="n">em</span><span class="p">;</span> <span class="n">maxoutdim</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c"># PCA speeds things up!</span>

<span class="nd">@time</span> <span class="n">target_pred</span> <span class="o">=</span> <span class="n">crossprediction</span><span class="p">(</span><span class="n">source_train</span><span class="p">,</span> <span class="n">target_train</span><span class="p">,</span> <span class="n">source_pred</span><span class="p">,</span> <span class="n">em</span><span class="p">;</span>
<span class="n">progress</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>

<span class="n">err</span> <span class="o">=</span> <span class="p">[</span><span class="n">abs</span><span class="o">.</span><span class="p">(</span><span class="n">target_test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">target_pred</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="n">Ttest</span><span class="p">]</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;Maximum error: &quot;</span><span class="p">,</span> <span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="nb">e</span><span class="p">)</span> <span class="k">for</span> <span class="nb">e</span> <span class="kp">in</span> <span class="n">err</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span> 55.597706 seconds (1.91 M allocations: 1.179 GiB, 1.28% gc time)
Maximum error: 0.3501152187355337
</pre></div>


<p><a id='Plot-prediction-1'></a></p>
<h3 id="plot-prediction">Plot prediction</h3>
<p>Deduce field extremal values</p>
<div class="codehilite"><pre><span></span><span class="n">source_max</span> <span class="o">=</span> <span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">source_pred</span><span class="p">)</span>
<span class="n">target_max</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">target_test</span><span class="p">),</span>
                 <span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">target_pred</span><span class="p">))</span>
<span class="n">source_min</span> <span class="o">=</span> <span class="n">minimum</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">source_pred</span><span class="p">)</span>
<span class="n">target_min</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">target_test</span><span class="p">),</span>
                 <span class="n">minimum</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">target_pred</span><span class="p">))</span>
</pre></div>


<p>Plot various predicted frames (only the last one shown here)</p>
<div class="codehilite"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">÷</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">err</span><span class="p">)]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">source_pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">source_min</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">source_max</span><span class="p">)</span>
    <span class="n">im2</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">target_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;cividis&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">target_min</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">target_max</span><span class="p">)</span>
    <span class="n">im3</span> <span class="o">=</span> <span class="n">ax3</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">target_pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;cividis&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">target_min</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">target_max</span><span class="p">)</span>
    <span class="n">im4</span> <span class="o">=</span> <span class="n">ax4</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">err</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;inferno&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">target_max</span> <span class="o">-</span> <span class="n">target_min</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">im</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="kp">in</span> <span class="n">zip</span><span class="p">([</span><span class="n">im1</span><span class="p">,</span><span class="n">im2</span><span class="p">,</span><span class="n">im3</span><span class="p">,</span><span class="n">im4</span><span class="p">],</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="o">:</span><span class="n">get_xaxis</span><span class="p">]()[</span><span class="o">:</span><span class="n">set_ticks</span><span class="p">]([])</span>
        <span class="n">ax</span><span class="p">[</span><span class="o">:</span><span class="n">get_yaxis</span><span class="p">]()[</span><span class="o">:</span><span class="n">set_ticks</span><span class="p">]([])</span>
        <span class="n">colorbar</span><span class="p">(</span><span class="nb">im</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span><span class="c">#, format=&quot;%.1f&quot;)</span>
    <span class="k">end</span>
    <span class="n">ax1</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;Source&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;Target Test&quot;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;Target Cross-Pred.&quot;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;absolute error&quot;</span><span class="p">)</span>
    <span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">)</span>
    <span class="n">suptitle</span><span class="p">(</span><span class="s">&quot;frame </span><span class="si">$i</span><span class="s">&quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>


<p><img alt="barkley_cross" src="../barkley_cross.png" /></p>
<p><a id='Temporal-Prediction:-Periodic-Nonlinear-Barkley-Model-1'></a></p>
<h2 id="temporal-prediction-periodic-nonlinear-barkley-model">Temporal Prediction: Periodic Nonlinear Barkley Model</h2>
<p>This example predicts the temporal evolution of a field U, which has to be represented as vectors of matrices. Where the field comes from does not matter, but to make the example runnable we load one of the test systems of TimeseriesPrediction.</p>
<p>This example uses light cone embedding and a nonlinear Barkley model.</p>
<p>Importantly, the results are compared with the "real" evolution of the system.</p>
<p><a id='Simulate-a-test-system-2'></a></p>
<h3 id="simulate-a-test-system_1">Simulate a test system</h3>
<div class="codehilite"><pre><span></span><span class="k">using</span> <span class="n">PyPlot</span>
<span class="k">using</span> <span class="n">TimeseriesPrediction</span>

<span class="n">testdir</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">pathof</span><span class="p">(</span><span class="n">TimeseriesPrediction</span><span class="p">)))</span><span class="o">*</span><span class="s">&quot;/test&quot;</span>
<span class="nd">@assert</span> <span class="n">isdir</span><span class="p">(</span><span class="n">testdir</span><span class="p">)</span>
<span class="n">include</span><span class="p">(</span><span class="n">testdir</span><span class="o">*</span><span class="s">&quot;/system_defs.jl&quot;</span><span class="p">)</span>

<span class="n">Ttrain</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">Ttest</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">Ttrain</span> <span class="o">+</span> <span class="n">Ttest</span>

<span class="n">init</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.6241</span>    <span class="mf">0.589685</span>  <span class="mf">0.668221</span>   <span class="mf">0.194882</span>    <span class="mf">0.687645</span>
         <span class="mf">0.656243</span>  <span class="mf">0.702544</span>  <span class="mf">0.476963</span>   <span class="mf">0.00236098</span>  <span class="mf">0.636111</span>
         <span class="mf">0.821854</span>  <span class="mf">0.868514</span>  <span class="mf">0.242682</span>   <span class="mf">0.2588</span>      <span class="mf">0.30552</span>
         <span class="mf">0.580972</span>  <span class="mf">0.355305</span>  <span class="mf">0.0805268</span>  <span class="mf">0.501724</span>    <span class="mf">0.728142</span>
         <span class="mf">0.297559</span>  <span class="mf">0.708676</span>  <span class="mf">0.583552</span>   <span class="mf">0.65363</span>     <span class="mf">0.555639</span><span class="p">]</span>

<span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">barkley</span><span class="p">(</span><span class="n">T</span><span class="p">;</span> <span class="n">tskip</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ssize</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="n">init</span> <span class="o">=</span> <span class="n">init</span><span class="p">)</span>
<span class="n">summary</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>┌ Warning: Replacing docs for `Main.ex-stexamples.barkley :: Tuple{Any}` in module `Main.ex-stexamples`
└ @ Base.Docs docs/Docs.jl:223
&quot;305-element Array{Array{Float64,2},1}&quot;
</pre></div>


<p><a id='Temporal-prediction-of-field-U-2'></a></p>
<h3 id="temporal-prediction-of-field-u_1">Temporal prediction of field U</h3>
<div class="codehilite"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">τ</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">r₀</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">bc</span> <span class="o">=</span> <span class="n">PeriodicBoundary</span><span class="p">()</span>

<span class="n">pool</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span> <span class="o">:</span> <span class="n">Ttrain</span><span class="p">]</span>
<span class="n">test</span>  <span class="o">=</span> <span class="n">U</span><span class="p">[</span> <span class="n">Ttrain</span> <span class="o">:</span> <span class="n">T</span><span class="p">]</span>

<span class="n">em</span> <span class="o">=</span> <span class="n">light_cone_embedding</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span><span class="n">τ</span><span class="p">,</span><span class="n">r₀</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">bc</span><span class="p">)</span>
<span class="n">pcaem</span> <span class="o">=</span> <span class="n">PCAEmbedding</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">em</span><span class="p">;</span> <span class="n">maxoutdim</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c"># PCA speeds things up!</span>

<span class="nd">@time</span> <span class="n">pred</span> <span class="o">=</span> <span class="n">temporalprediction</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">em</span><span class="p">,</span> <span class="n">Ttest</span><span class="p">;</span> <span class="n">progress</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>

<span class="n">err</span> <span class="o">=</span> <span class="p">[</span><span class="n">abs</span><span class="o">.</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">:</span><span class="n">Ttest</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

<span class="n">println</span><span class="p">(</span><span class="s">&quot;Maximum error: &quot;</span><span class="p">,</span> <span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="nb">e</span><span class="p">)</span> <span class="k">for</span> <span class="nb">e</span> <span class="kp">in</span> <span class="n">err</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span> 22.870086 seconds (1.73 M allocations: 931.278 MiB, 1.51% gc time)
Maximum error: 0.2934269941090367
</pre></div>


<p><a id='Plot-prediction-2'></a></p>
<h3 id="plot-prediction_1">Plot prediction</h3>
<p>Deduce field maximum values</p>
<div class="codehilite"><pre><span></span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">test</span><span class="p">),</span>
           <span class="n">maximum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">pred</span><span class="p">))</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">test</span><span class="p">),</span>
           <span class="n">minimum</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">pred</span><span class="p">))</span>
</pre></div>


<p>plot plot plot</p>
<div class="codehilite"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">÷</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">err</span><span class="p">)]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">)</span>
    <span class="n">im2</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">)</span>
    <span class="n">im3</span> <span class="o">=</span> <span class="n">ax3</span><span class="p">[</span><span class="o">:</span><span class="n">imshow</span><span class="p">](</span><span class="n">err</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&quot;inferno&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">im</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="kp">in</span> <span class="n">zip</span><span class="p">([</span><span class="n">im1</span><span class="p">,</span><span class="n">im2</span><span class="p">,</span><span class="n">im3</span><span class="p">],</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="o">:</span><span class="n">get_xaxis</span><span class="p">]()[</span><span class="o">:</span><span class="n">set_ticks</span><span class="p">]([])</span>
        <span class="n">ax</span><span class="p">[</span><span class="o">:</span><span class="n">get_yaxis</span><span class="p">]()[</span><span class="o">:</span><span class="n">set_ticks</span><span class="p">]([])</span>
        <span class="n">colorbar</span><span class="p">(</span><span class="nb">im</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span><span class="c">#, format=&quot;%.1f&quot;)</span>
    <span class="k">end</span>
    <span class="n">ax1</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;Prediction&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;Real evolution&quot;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="p">[</span><span class="o">:</span><span class="n">set_title</span><span class="p">](</span><span class="s">&quot;Absolute error&quot;</span><span class="p">)</span>
    <span class="n">suptitle</span><span class="p">(</span><span class="s">&quot;frame </span><span class="si">$i</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">)</span>
    <span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>


<p><img alt="barkley_tempo" src="../barkley_tempo.png" /></p>
<p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../spatiotemporal/" title="Spatio-Temporal Prediction" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Spatio-Temporal Prediction
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/JuliaDynamics/TimeseriesPrediction.jl" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.30f6b8b1.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:".."}})</script>
      
        <script src="../assets\mathjaxhelper.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>